"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tab=exports.Tabs=void 0;var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,a,o){return a&&e(t.prototype,a),o&&e(t,o),t}}(),_react=require("react"),_react2=_interopRequireDefault(_react),Tabs=exports.Tabs=function(e){function t(){var e,a,o,n;_classCallCheck(this,t);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];return a=o=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),o.dragTarget=null,o.mouseMoveHandler=o.handleMouseMove.bind(o),o.mouseUpHandler=o.handleMouseUp.bind(o),o.tooltipTimeout=null,o.singleTabWidth=0,o.singleTabWidthInPercent=0,o.tabTotal=0,n=a,_possibleConstructorReturn(o,n)}return _inherits(t,e),_createClass(t,[{key:"switchTab",value:function(e){this.props.onTabSwitch(e)}},{key:"recalculateSingleTabWidth",value:function(){if(this.props.maxTabWidth&&this.refs.tabs){var e=this.refs.tabs.offsetWidth/100,t=this.singleTabWidthInPercent*e,a=Math.min(t,this.props.maxTabWidth);this.singleTabWidth=100*a/this.refs.tabs.offsetWidth}}},{key:"handleMouseDown",value:function(e){this.recalculateSingleTabWidth(),this.dragTarget={target:e.currentTarget,x:e.currentTarget.offsetLeft,left:e.currentTarget.offsetLeft+"px",mouseX:e.pageX,index:this.getIndexByLeft(e.currentTarget.offsetLeft)}}},{key:"handleMouseUp",value:function(){this.dragTarget=null,this.forceUpdate()}},{key:"handleMouseMove",value:function(e){if(this.dragTarget){this.recalculateSingleTabWidth(),e.preventDefault(),e.stopPropagation();var t=this.dragTarget,a=(t.target,this.refs.tabs.offsetWidth/100),o=a+a*this.singleTabWidth*(this.tabTotal-1),n=t.x+e.pageX-t.mouseX;n<a&&(n=a),n>o&&(n=o);var i=this.getIndexByLeft(n);if(i!=t.index){var r=i,s=t.index;this.props.onTabPositionChange(r,s),t.index=i}t.left=n+"px",this.hideTooltip(),this.forceUpdate()}}},{key:"handleClose",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onTabClose(e)}},{key:"handleAdd",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onTabAdd()}},{key:"getLeftByIndex",value:function(e){return this.recalculateSingleTabWidth(),1+this.singleTabWidth*e}},{key:"getIndexByLeft",value:function(e){var t=this.refs.tabs.offsetWidth/100;return Math.round((e-t)/(t*this.singleTabWidth))}},{key:"showTooltip",value:function(e,t){var a=this,o=e||t.currentTarget.getElementsByClassName("text")[0].innerText,n=t.currentTarget.offsetLeft;this.tooltipTimeout||(this.tooltipTimeout=window.setTimeout(function(){a.refs.tooltip.innerText=o,a.refs.tooltip.style.display="block",a.refs.tooltip.style.left=n+30+"px"},800))}},{key:"hideTooltip",value:function(){window.clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null,this.refs.tooltip.style.display="none"}},{key:"componentDidMount",value:function(){this.props.draggable&&(window.addEventListener("mousemove",this.mouseMoveHandler),window.addEventListener("mouseup",this.mouseUpHandler)),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.props.draggable&&(window.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler))}},{key:"render",value:function(){var e=this,t=this.props;this.tabTotal=t.children.length,this.singleTabWidth=98/this.tabTotal,this.singleTabWidthInPercent=this.singleTabWidth;var a=t.children.map(function(a,o){var n={},i=o,r=null;a.props.icon&&(r="string"==typeof a.props.icon?_react2.default.createElement(TabIcon,{type:a.props.icon}):a.props.icon),n.zIndex=e.tabTotal-i,n.left=e.getLeftByIndex(i)+"%",n.width=e.singleTabWidth+"%",t.maxTabWidth&&(n.maxWidth=t.maxTabWidth+"px"),e.dragTarget&&e.dragTarget.index==i&&(n.left=e.dragTarget.left);var s=t.hideTooltip||a.props.hideTooltip;return _react2.default.createElement("div",{key:a.props.id,className:"tab-button"+(t.active==o?" active":""),style:n,onClick:e.switchTab.bind(e,o),onMouseDown:e.handleMouseDown.bind(e),onMouseEnter:s?null:e.showTooltip.bind(e,a.props.tooltip),onMouseLeave:s?null:e.hideTooltip.bind(e)},_react2.default.createElement("div",{className:"tab",style:e.props.color?{borderColor:e.props.color}:null}),_react2.default.createElement("div",{className:"text"+(a.props.showClose?" with-close":"")},r,a.props.title),a.props.showClose?_react2.default.createElement("div",{className:"close",onClick:e.handleClose.bind(e,o)}):null)});return _react2.default.createElement("div",{className:"r-a-t"},_react2.default.createElement("div",{className:"tab-wrapper"+(this.props.showAdd?" with-add":""),ref:"tabs"},a),this.props.showAdd?_react2.default.createElement("div",{className:"add-wrapper",onClick:this.handleAdd.bind(this)}):null,_react2.default.createElement("div",{className:"tooltip",ref:"tooltip"}))}}]),t}(_react.Component),Tab=function(e){var t=e.children;return _react2.default.createElement("div",null,t)},TabIcon=function(e){var t=e.type;return _react2.default.createElement("div",{className:"icon "+t},"loading"==t?_react2.default.createElement("div",{className:"mask"}):null)};exports.default=Tabs,exports.Tab=Tab;